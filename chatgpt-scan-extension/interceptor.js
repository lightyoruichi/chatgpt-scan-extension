const S={name:"ChatGPT",shouldIntercept(i){return i.includes("/backend-api/conversation")||i.includes("/backend-api/lat/r")},extractQueries(i){var m,f,u,t,o,l,r,e;const n=new Set,p=i.split(`
`);for(const a of p){const c=a.trim();if(c.startsWith("data: "))try{const s=c.slice(6).trim();if(s==="[DONE]")continue;const g=JSON.parse(s),y=g==null?void 0:g.message,d=y==null?void 0:y.metadata,_=(u=(f=(m=y==null?void 0:y.content)==null?void 0:m.parts)==null?void 0:f[0])==null?void 0:u.tool_calls;Array.isArray(_)&&_.forEach(h=>{var w;(h==null?void 0:h.name)==="google_search"&&((w=h==null?void 0:h.arguments)!=null&&w.query)&&n.add(h.arguments.query)});const A=d==null?void 0:d.search_model_queries;Array.isArray(A)&&A.forEach(h=>{typeof h=="string"&&n.add(h)});const q=d==null?void 0:d.tool_uses;Array.isArray(q)&&q.forEach(h=>{const w=h==null?void 0:h.name;if((w==="google_search"||w==="search"||w==="web_search")&&h!=null&&h.arguments)try{const E=typeof h.arguments=="string"?JSON.parse(h.arguments):h.arguments;E.query&&n.add(E.query)}catch{}}),d&&Object.keys(d).forEach(h=>{h.toLowerCase().includes("query")&&Array.isArray(d[h])&&d[h].forEach(w=>{typeof w=="string"&&n.add(w)})})}catch{}else if(c.length>20&&c.startsWith("{"))try{const s=JSON.parse(c),g=((t=s==null?void 0:s.message)==null?void 0:t.metadata)||(s==null?void 0:s.metadata);g!=null&&g.search_model_queries&&Array.isArray(g.search_model_queries)&&g.search_model_queries.forEach(d=>{typeof d=="string"&&n.add(d)});const y=(e=(r=(l=(o=s==null?void 0:s.message)==null?void 0:o.content)==null?void 0:l.parts)==null?void 0:r[0])==null?void 0:e.tool_calls;Array.isArray(y)&&y.forEach(d=>{var _;(d==null?void 0:d.name)==="google_search"&&((_=d==null?void 0:d.arguments)!=null&&_.query)&&n.add(d.arguments.query)})}catch{}}if(n.size===0&&i.includes("search_model_queries")){const a=/"search_model_queries"\s*:\s*\{[^}]*?"queries"\s*:\s*(\[[^\]]+\])/,c=i.match(a);if(c!=null&&c[1])try{const s=JSON.parse(c[1]);Array.isArray(s)&&s.forEach(g=>{typeof g=="string"&&n.add(g)})}catch{}}if(n.size===0&&i.includes("google_search")){const a=/"name"\s*:\s*"google_search"[^}]*"arguments"\s*:\s*"(\{.*?\})"/g;let c;for(;(c=a.exec(i))!==null;)try{const s=JSON.parse(c[1].replace(/\\"/g,'"').replace(/\\\\/g,"\\"));s.query&&n.add(s.query)}catch{}}return n.size>0?Array.from(n):null}},C={name:"Claude",shouldIntercept(i){return i.includes("/api/organizations/")&&i.includes("/chat_conversations/")||i.includes("/completion")},extractQueries(i){var f,u;const n=new Set;try{const t=JSON.parse(i);t!=null&&t.chat_messages&&Array.isArray(t.chat_messages)&&t.chat_messages.forEach(o=>{var l;(l=o==null?void 0:o.content)==null||l.forEach(r=>{var e;(r==null?void 0:r.type)==="tool_use"&&(r==null?void 0:r.name)==="web_search"&&((e=r==null?void 0:r.input)!=null&&e.query)&&n.add(r.input.query)})}),(u=(f=t==null?void 0:t.completion)==null?void 0:f.input)!=null&&u.query&&n.add(t.completion.input.query)}catch{}const p=/"type"\s*:\s*"tool_use"[^}]*"name"\s*:\s*"web_search"[^}]*"input"\s*:\s*\{[^}]*"query"\s*:\s*"((?:[^"\\]|\\.)*)"/g;let m;for(;(m=p.exec(i))!==null;)try{const t=m[1].replace(/\\"/g,'"').replace(/\\\\/g,"\\");t&&n.add(t)}catch{}return n.size>0?Array.from(n):null}},W={name:"Perplexity",shouldIntercept(i){return i.includes("perplexity.ai")&&(i.includes("/rest/sse/perplexity_ask")||i.includes("/rest/thread/")&&i.includes("with_schematized_response=true"))},extractQueries(i){const n=new Set,p=i.split(`
`);for(const f of p){const u=f.trim();if(u.startsWith("data: ")||u.startsWith("{")&&u.endsWith("}"))try{const t=u.startsWith("data: ")?u.slice(6).trim():u;if(t==="[DONE]"||!t)continue;const o=JSON.parse(t),l=r=>{if(!(!r||typeof r!="object")){Array.isArray(r.search_queries)&&r.search_queries.forEach(e=>{typeof e=="string"?n.add(e):e.query&&n.add(e.query)}),Array.isArray(r.citations)&&r.citations.forEach(e=>{e.query&&n.add(e.query),e.search_query&&n.add(e.search_query)}),Array.isArray(r.steps)&&r.steps.forEach(e=>{(e.type==="search"||e.step_type==="SEARCH_WEB")&&(e.query||e.search_query)&&n.add(e.query||e.search_query)});for(const e in r){if(e==="related_queries"||e==="suggested_queries")continue;const a=r[e];(e==="query"||e==="search_query")&&typeof a=="string"?n.add(a):typeof a=="object"&&l(a)}}};l(o)}catch{}}const m=[/"search_query"\s*:\s*"((?:[^"\\]|\\.)*)"/g,/"query"\s*:\s*"((?:[^"\\]|\\.)*)"/g];for(const f of m){let u;for(;(u=f.exec(i))!==null;){const t=i.substring(Math.max(0,u.index-50),u.index);if(t.includes("related_queries")||t.includes("suggested_queries"))continue;const o=u[1].replace(/\\"/g,'"').replace(/\\\\/g,"\\");o&&o.length>3&&o.length<500&&n.add(o)}}return n.size>0?Array.from(n):null}},O={name:"Gemini",shouldIntercept(i){return(i.includes("gemini.google.com")||i.includes("generativelanguage.googleapis.com")||i.includes("googleapis.com")||i.includes("gstatic.com")||window.location.hostname.includes("gemini.google")&&i.startsWith("/"))&&(i.includes("/api/")||i.includes("/v1/")||i.includes("/generate")||i.includes("/stream")||i.includes("/chat")||i.includes("/search")||i.includes("/models/")||i.includes("generateContent")||i.includes("streamGenerateContent")||i.includes("/_/BardChatUi/data/batchexecute"))},extractQueries(i){const n=new Set;let p=i.trim();p.startsWith(")]}'")&&(p=p.substring(5).trim());const m=p.split(/\n\d+\n/),f=[];for(const t of m)if(t.trim())try{f.push(JSON.parse(t))}catch{const l=t.match(/[\[\{][\s\S]*[\]\}]/);if(l)try{f.push(JSON.parse(l[0]))}catch{}}const u=(t,o="")=>{var l;if(!(!t||typeof t!="object")&&!o.match(/\[2\]\[(\d+)\]\[1\]/))if(Array.isArray(t)){const r=o.match(/\[0\]\[0\]\[3\]\[1\]\[(\d+)\]$/);t.forEach((e,a)=>{const c=`${o}[${a}]`;if(a===2&&typeof e=="string"&&e.length>10){const s=e.trim();if(s.startsWith("[")||s.startsWith("{"))try{const g=JSON.parse(e);u(g,`${c}(parsed)`)}catch{}}if(typeof e=="string"){const s=e.trim();if(!!r&&a===0){const y=s.split(/\s+/).filter(_=>_.length>0);s.length>=10&&s.length<=150&&y.length>=3&&y.length<=15&&!s.includes("http")&&!s.includes("@")&&!s.match(/^rc?_[a-f0-9]/i)&&!s.match(/^c_[a-f0-9]+/i)&&!s.match(/^r_[a-f0-9]+/i)&&!s.includes("**")&&!s.includes("*")&&!s.startsWith("#")&&!s.endsWith(".")&&!s.endsWith(":")&&!s.endsWith("!")&&!s.endsWith("?")&&!s.match(/^(What|Why|How|Is|Are|Who|Where|When|Does|Which|Can|Will|Should|Would|Could|May)\s/i)&&!s.match(/^(The|Here|Following|After|Current|Today|This|That|These|Those|A|An|I|You|We|They)\s/i)&&!(y.length<=3&&s===s.replace(/\b\w/g,_=>_.toUpperCase()))&&!(s===s.toUpperCase()&&s.length<30)&&!s.match(/^\d+\.\s/)&&!s.startsWith("* ")&&!s.startsWith("- ")&&!/^[a-f0-9]{32}$/i.test(s)&&!s.startsWith("SWML_")&&!s.includes("\\u003d")&&s.match(/\b(latest|news|update|search|find|information|about|regarding|related to|status|report|case|issue|policy|ban|law|legal|government|mall|pet|Malaysia|December|2025|investigation|challenge|update|today)\b/i)&&(console.log("[AI Search Revealer] Gemini Match:",s),n.add(s))}}u(e,c)})}else{const r=t;for(const e in r){const a=r[e],c=o?`${o}.${e}`:e;if((e==="query"||e==="search_query"||e==="searchQuery"||e==="search_queries"||e==="searchQueryText"||e==="queryText"||e==="text")&&typeof a=="string"&&a.length>5&&a.length<500&&n.add(a),e==="functionCall"&&a&&typeof a=="object"){const s=a;(s.name==="search"||s.name==="web_search")&&((l=s.args)!=null&&l.query)&&n.add(s.args.query)}typeof a=="object"&&a!==null&&u(a,c)}}};if(f.forEach(t=>u(t)),n.size===0){const t=[/"query"\s*:\s*"((?:[^"\\]|\\.)*)"/g,/"search_query"\s*:\s*"((?:[^"\\]|\\.)*)"/g,/"searchQuery"\s*:\s*"((?:[^"\\]|\\.)*)"/g];for(const r of t){let e;for(;(e=r.exec(i))!==null;){const a=e[1].replace(/\\"/g,'"').replace(/\\\\/g,"\\");a.length>10&&a.length<150&&!a.includes("http")&&n.add(a)}}const o=/(?:^|[^\\])["']([a-zA-Z][a-zA-Z0-9\s]{2,40}?)(?:["']|\\["'])/g;let l;for(;(l=o.exec(i))!==null;){const r=l[1].trim(),e=r.split(/\s+/).filter(c=>c.length>0);r.length>=10&&r.length<=80&&e.length>=3&&e.length<=8&&!r.toLowerCase().includes("http")&&!r.includes("@")&&!r.match(/^c_[a-f0-9]+/i)&&!r.match(/^r_[a-f0-9]+/i)&&!r.match(/^rc_[a-f0-9]+/i)&&!r.includes("\\u")&&!r.includes("**")&&!r.includes("*")&&!r.endsWith(".")&&!r.endsWith(":")&&!r.endsWith("!")&&!r.endsWith("?")&&!r.match(/^(What|Why|How|Is|Are|Does|Which|Who|When|Where|Can|Will|Should|Would|Could|May)\s/i)&&!r.match(/^(The|Here|Following|After|Current|Today|This|That|These|Those|A|An|I|You|We|They)\s/i)&&r.match(/\b(latest|news|update|search|find|information|about|regarding|related to|status|report|case|issue|policy|ban|law|legal|government|mall|pet|Malaysia|December|2025)\b/i)&&n.add(r)}}return n.size>0&&console.log("[AI Search Revealer] Gemini Found total:",n.size),n.size>0?Array.from(n):null}};if(window.__AI_SEARCH_REVEALER_INTERCEPTOR_LOADED__)console.log("%c[AI Search Revealer Interceptor]","color: #00f2fe; font-weight: bold; font-size: 12px;","Already loaded, skipping re-initialization");else{window.__AI_SEARCH_REVEALER_INTERCEPTOR_LOADED__=!0;const i=[S,C,W,O],n=(...t)=>{console.log("%c[AI Search Revealer Interceptor]","color: #00f2fe; font-weight: bold; font-size: 12px;",...t)};n("Initializing..."),window.addEventListener("message",t=>{var o;((o=t.data)==null?void 0:o.type)==="PING_INTERCEPTOR"&&window.postMessage({type:"INTERCEPTOR_READY"},"*")});const p=(t,o)=>{if(t.length===0)return;n(`Found queries for ${o||"Unknown"}:`,t);const l={type:"AI_SEARCH_REVEALER_FOUND",queries:t,platform:o};window.postMessage(l,"*")},m=window.fetch;window.fetch=function(t,o){const l=typeof t=="string"?t:t instanceof URL?t.toString():t.url;if(l&&["ab.chatgpt.com","statsig","googletagmanager.com","google-analytics.com","play.google.com/log","google.com/ccm/collect"].some(c=>l.includes(c)))return Promise.resolve(new Response(null,{status:200}));const e=i.find(c=>{try{return c.shouldIntercept(l)}catch{return!1}}),a=m.apply(window,[t,o]);return e&&a.then(async c=>{if(!c.ok){n(`Response code ${c.status} for ${e.name}`);return}try{const g=await c.clone().text();n(`Processing ${g.length} bytes for ${e.name}`);const y=e.extractQueries(g);y&&y.length>0&&p(y,e.name)}catch(s){n("Error processing:",s)}}).catch(c=>{n("Fetch promise rejected:",c)}),a};const f=window.EventSource;f&&(window.EventSource=function(t,o){n("EventSource created for:",t);const l=new f(t,o),r=i.find(e=>e.shouldIntercept(t.toString()));return r&&l.addEventListener("message",e=>{const a=r.extractQueries(`data: ${e.data}`);a&&p(a,r.name)}),l},Object.setPrototypeOf(window.EventSource,f),window.EventSource.prototype=f.prototype,window.EventSource.CONNECTING=f.CONNECTING,window.EventSource.OPEN=f.OPEN,window.EventSource.CLOSED=f.CLOSED);const u=window.XMLHttpRequest;u&&(window.XMLHttpRequest=function(){const t=new u;let o=null;const l=t.open;t.open=function(...e){return o=e[1],l.apply(this,e)};const r=()=>{if(t.readyState===4&&o){const e=i.find(a=>a.shouldIntercept(o));if(e&&t.responseText){const a=e.extractQueries(t.responseText);a&&p(a,e.name)}}};return t.addEventListener("readystatechange",r),t.addEventListener("load",r),t},Object.setPrototypeOf(window.XMLHttpRequest,u),window.XMLHttpRequest.prototype=u.prototype),n("===== INTERCEPTOR LOADED & READY =====")}
